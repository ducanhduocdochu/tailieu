apt install openjdk-17-jdk openjdk-17-jre -y
java --version
wget -p -O - https://pkg.jenkins.io/debian/jenkins.io.key | apt-key add -
sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 5BA31D57EF5975CA
apt-get update
apt install jenkins -y
systemctl start jenkins
ufw allow 8080

sudo mkdir -p /etc/jenkins/ssl
sudo chmod 700 /etc/jenkins/ssl
sudo nano /etc/jenkins/ssl/jenkins.ducanh.io.vn.crt
sudo chmod 644 /etc/jenkins/ssl/jenkins.ducanh.io.vn.crt
sudo nano /etc/jenkins/ssl/jenkins.ducanh.io.vn.key
sudo chmod 600 /etc/jenkins/ssl/jenkins.ducanh.io.vn.key

sudo apt install -y nginx
sudo nano /etc/nginx/sites-available/jenkins
server {
    listen 443 ssl;
    server_name jenkins.ducanh.io.vn;

    ssl_certificate     /etc/jenkins/ssl/jenkins.ducanh.io.vn.crt;
    ssl_certificate_key /etc/jenkins/ssl/jenkins.ducanh.io.vn.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://127.0.0.1:8080;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}

sudo ln -s /etc/nginx/sites-available/jenkins /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
